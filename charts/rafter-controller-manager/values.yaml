# Default values for rafter.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

nameOverride:
fullnameOverride:

image:
  repository: rafter-controller-manager
  tag: latest
  pullPolicy: Never

installCRDs: true

deployment:
  labels: {}
  annotations: {}
  replicas: 1
  extraProperties: {}

pod:
  labels: {}
  annotations: {}
    # sidecar.istio.io/inject: "false"
    # recreate: "{{ .Release.Time.Seconds }}"
  resources:
    limits:
      cpu: 150m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 32Mi
  volumes:
    - name: tmp-empty-dir
      emptyDir: {}
  volumeMounts:
    - mountPath: /tmp
      name: tmp-empty-dir
  extraProperties:
    terminationGracePeriodSeconds: 10
    # hostAliases:
    #   - ip: {{ .Values.global.minikubeIP }}
    #     hostnames:
    #       - "minio.{{ .Values.global.ingress.domainName }}"
  extraContainerProperties: {}

serviceAccount:
  create: true
  name:
  labels: {}
  annotations: {}

rbac:
  clusterScope:
    create: true
    role:
      name:
      labels: {}
      annotations: {}
      extraRules: []
    roleBinding:
      name:
      labels: {}
      annotations: {}
  namespaced:
    create: true
    role:
      name:
      labels: {}
      annotations: {}
      extraRules: []
    roleBinding:
      name:
      labels: {}
      annotations: {}

webhooksConfigMap:
  create: true
  name:
  namespace: "{{ .Release.Namespace }}"
  hooks:
    markdown: |-
      {
        "metadataExtractors":[
          {
            "name": "rafter-frontmatter-service",
            "namespace": "default",
            "endpoint": "/v1/extract",
            "filter": "\\.md$"
          }
        ]
      }
    asyncapi: |-
      {
        "validations":[
          {
            "name": "rafter-asyncapi-service",
            "namespace": "default",
            "endpoint": "/v1/validate"
          }
        ],
        "mutations":[
          {
            "name": "rafter-asyncapi-service",
            "namespace": "default",
            "endpoint": "/v1/convert"
          }
        ]
      }
  labels: {}
  annotations: {}

metrics:
  enabled: true
  service:
    name:
    type: ClusterIP
    port:
      name: metrics
      internal: metrics
      external: 8080
      protocol: TCP
    labels: {}
    annotations: {}
  serviceMonitor:
    create: false
    name:
    scrapeInterval: 30s
    labels: {}
    annotations: {}
  pod:
    labels: {}
    annotations: {}
      # prometheus.io/scrape: "true"
      # prometheus.io/port: "8080"
      # prometheus.io/path: "/metrics"

envs:
  clusterAssetGroup:
    relistInterval: 
      value: 5m
  assetGroup:
    relistInterval: 
      value: 5m
  clusterBucket:
    relistInterval: 
      value: 30s
    maxConcurrentReconciles: 
      value: "1"
    region: 
      value: us-east-1
  bucket:
    relistInterval: 
      value: 30s
    maxConcurrentReconciles: 
      value: "1"
    region: 
      value: us-east-1
  clusterAsset:
    relistInterval: 
      value: 30s
    maxConcurrentReconciles: 
      value: "1"
  asset:
    relistInterval: 
      value: 30s
    maxConcurrentReconciles: 
      value: "1"
  store:
    endpoint: 
      value: '{{ include "rafter.fullname" . }}-minio.{{ .Release.Namespace }}.svc.cluster.local:9000'
      # valueFrom:
      #   configMapKeyRef:
      #     name: '{{ include "rafter.fullname" . }}-minio'
      #     key: APP_UPLOAD_ENDPOINT_WITH_PORT
    externalEndpoint:
    accessKey:
      valueFrom:
        secretKeyRef:
          name: '{{ include "rafter.fullname" . }}-minio'
          key: accesskey
    secretKey:
      valueFrom:
        secretKeyRef:
          name: '{{ include "rafter.fullname" . }}-minio'
          key: secretkey
    useSSL: 
      value: "false"
      # valueFrom:
      #   configMapKeyRef:
      #     name: '{{ include "rafter.fullname" . }}-minio'
      #     key: APP_UPLOAD_SECURE
    uploadWorkers: 
      value: "10"
  loader:
    verifySSL: 
      value: "false"
    tempDir: 
      value: "/tmp"
  webhooks:
    validation:
      timeout: 
        value: 1m
      workers: 
        value: "10"
    mutation:
      timeout: 
        value: 1m
      workers: 
        value: "10"
    metadata:
      timeout: 
        value: 1m
